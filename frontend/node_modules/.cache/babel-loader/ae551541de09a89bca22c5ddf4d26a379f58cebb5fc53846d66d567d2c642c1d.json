{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import io from'socket.io-client';import{Score}from'./Score';import BsNav from'../Containers/BsNav';import'../styles/MusicVisualiser.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const MusicVisualiser=()=>{const[noteData,setNoteData]=useState([]);const[refreshKey,setRefreshKey]=useState(0);// A key to force re-render\nconst apiUrl=process.env.REACT_APP_API_BASE_URL;const wsUrl=process.env.REACT_APP_WS_URL;// Function to fetch note data\nconst fetchNotes=async()=>{try{const response=await axios.get(\"\".concat(apiUrl,\"/get_note_data?limit=16\"));setNoteData(response.data);console.log('Note data fetched');}catch(error){console.error('Error fetching note data:',error);}};useEffect(()=>{fetchNotes();// Fetch initial note data\n// WebSocket connection setup\nconst socket=io(wsUrl);socket.on('connect',()=>{console.log('Connected to WebSocket server');});// Listen for the specific message to re-render the component\nsocket.on('data_update',()=>{console.log('data update received, refreshing component');setRefreshKey(prevKey=>prevKey+1);// Update the key to force re-render\nwindow.location.reload();fetchNotes();// Optionally fetch the latest notes again\n});return()=>{socket.disconnect();// Clean up on component unmount\n};},[refreshKey]);// Depend on refreshKey to re-run the effect when it changes\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"MainPage-page\",children:[/*#__PURE__*/_jsx(BsNav,{}),/*#__PURE__*/_jsx(\"div\",{className:\"centered-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"score-container\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"instruction-text\",children:\"Here is a real-time score generator. Step on the musical stairs to see what notes you have played!\"}),/*#__PURE__*/_jsx(Score,{className:\"Score\",staves:noteData})]})})]},refreshKey);};export default MusicVisualiser;","map":{"version":3,"names":["React","useEffect","useState","axios","io","Score","BsNav","jsx","_jsx","jsxs","_jsxs","MusicVisualiser","noteData","setNoteData","refreshKey","setRefreshKey","apiUrl","process","env","REACT_APP_API_BASE_URL","wsUrl","REACT_APP_WS_URL","fetchNotes","response","get","concat","data","console","log","error","socket","on","prevKey","window","location","reload","disconnect","className","children","staves"],"sources":["/Users/fitzpatrickcarl/Documents/project-root/frontend/src/Components/MusicVisualiser.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport io from 'socket.io-client';\nimport { Score } from './Score';\nimport BsNav from '../Containers/BsNav';\nimport '../styles/MusicVisualiser.css';\n\nconst MusicVisualiser = () => {\n  const [noteData, setNoteData] = useState([]);\n  const [refreshKey, setRefreshKey] = useState(0); // A key to force re-render\n  const apiUrl = process.env.REACT_APP_API_BASE_URL;\n  const wsUrl = process.env.REACT_APP_WS_URL; \n  \n  // Function to fetch note data\n  const fetchNotes = async () => {\n    try {\n      const response = await axios.get(`${apiUrl}/get_note_data?limit=16`);\n      setNoteData(response.data);\n      console.log('Note data fetched');\n    } catch (error) {\n      console.error('Error fetching note data:', error);\n    }\n  };\n\n  useEffect(() => {\n    fetchNotes(); // Fetch initial note data\n    \n    // WebSocket connection setup\n    const socket = io(wsUrl);\n    socket.on('connect', () => {\n      console.log('Connected to WebSocket server');\n    });\n\n    // Listen for the specific message to re-render the component\n    socket.on('data_update', () => {\n      console.log('data update received, refreshing component');\n      setRefreshKey(prevKey => prevKey + 1); // Update the key to force re-render\n      window.location.reload();\n      fetchNotes(); // Optionally fetch the latest notes again\n    });\n\n    return () => {\n      socket.disconnect(); // Clean up on component unmount\n    };\n  }, [refreshKey]); // Depend on refreshKey to re-run the effect when it changes\n\n  return (\n    <div key={refreshKey} className=\"MainPage-page\">\n      <BsNav />\n      <div className=\"centered-content\">\n        <div className=\"score-container\">\n          <p className=\"instruction-text\">Here is a real-time score generator. Step on the musical stairs to see what notes you have played!</p>\n          <Score className=\"Score\" staves={noteData} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MusicVisualiser;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,EAAE,KAAM,kBAAkB,CACjC,OAASC,KAAK,KAAQ,SAAS,CAC/B,MAAO,CAAAC,KAAK,KAAM,qBAAqB,CACvC,MAAO,+BAA+B,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAEvC,KAAM,CAAAC,eAAe,CAAGA,CAAA,GAAM,CAC5B,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAGX,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACY,UAAU,CAAEC,aAAa,CAAC,CAAGb,QAAQ,CAAC,CAAC,CAAC,CAAE;AACjD,KAAM,CAAAc,MAAM,CAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB,CACjD,KAAM,CAAAC,KAAK,CAAGH,OAAO,CAACC,GAAG,CAACG,gBAAgB,CAE1C;AACA,KAAM,CAAAC,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC7B,GAAI,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAApB,KAAK,CAACqB,GAAG,IAAAC,MAAA,CAAIT,MAAM,2BAAyB,CAAC,CACpEH,WAAW,CAACU,QAAQ,CAACG,IAAI,CAAC,CAC1BC,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC,CAClC,CAAE,MAAOC,KAAK,CAAE,CACdF,OAAO,CAACE,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACnD,CACF,CAAC,CAED5B,SAAS,CAAC,IAAM,CACdqB,UAAU,CAAC,CAAC,CAAE;AAEd;AACA,KAAM,CAAAQ,MAAM,CAAG1B,EAAE,CAACgB,KAAK,CAAC,CACxBU,MAAM,CAACC,EAAE,CAAC,SAAS,CAAE,IAAM,CACzBJ,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC,CAC9C,CAAC,CAAC,CAEF;AACAE,MAAM,CAACC,EAAE,CAAC,aAAa,CAAE,IAAM,CAC7BJ,OAAO,CAACC,GAAG,CAAC,4CAA4C,CAAC,CACzDb,aAAa,CAACiB,OAAO,EAAIA,OAAO,CAAG,CAAC,CAAC,CAAE;AACvCC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC,CACxBb,UAAU,CAAC,CAAC,CAAE;AAChB,CAAC,CAAC,CAEF,MAAO,IAAM,CACXQ,MAAM,CAACM,UAAU,CAAC,CAAC,CAAE;AACvB,CAAC,CACH,CAAC,CAAE,CAACtB,UAAU,CAAC,CAAC,CAAE;AAElB,mBACEJ,KAAA,QAAsB2B,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC7C9B,IAAA,CAACF,KAAK,GAAE,CAAC,cACTE,IAAA,QAAK6B,SAAS,CAAC,kBAAkB,CAAAC,QAAA,cAC/B5B,KAAA,QAAK2B,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eAC9B9B,IAAA,MAAG6B,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAC,oGAAkG,CAAG,CAAC,cACtI9B,IAAA,CAACH,KAAK,EAACgC,SAAS,CAAC,OAAO,CAACE,MAAM,CAAE3B,QAAS,CAAE,CAAC,EAC1C,CAAC,CACH,CAAC,GAPEE,UAQL,CAAC,CAEV,CAAC,CAED,cAAe,CAAAH,eAAe"},"metadata":{},"sourceType":"module","externalDependencies":[]}